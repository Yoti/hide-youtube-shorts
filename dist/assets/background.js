chrome.runtime.onInstalled.addListener(async t=>{if(t.reason==="install"&&(chrome.storage.sync.set({presentModal:!0,toggleState:!0,toggleNavState:!0,toggleHomeFeedState:!0,toggleHomeFeedStateLives:!1,toggleHomeFeedStatePremieres:!1,toggleSubscriptionFeedState:!0,toggleSubscriptionFeedStateLives:!1,toggleSubscriptionFeedStatePremieres:!1,toggleTrendingFeedState:!0,toggleSearchState:!0,toggleRecommendedState:!0,toggleTabState:!0,toggleHomeTabState:!0,toggleTurboState:!1,toggleRegularState:!0,toggleNotificationState:!0}).catch(()=>{console.log("[STORAGE] Could not set storage item")}),chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(s){s.forEach(o=>{chrome.tabs.reload(o.id)})}),chrome.action.setBadgeBackgroundColor({color:"#ed5a64"}),chrome.action.setBadgeText({text:"1"})),t.reason==="update"){const s=["toggleState","toggleNavState","toggleHomeFeedState","toggleHomeFeedStateLives","toggleHomeFeedStatePremieres","toggleSubscriptionFeedState","toggleSubscriptionFeedStateLives","toggleSubscriptionFeedStatePremieres","toggleTrendingFeedState","toggleSearchState","toggleRecommendedState","toggleTabState","toggleHomeTabState","toggleTurboState","toggleRegularState","toggleNotificationState"],o=await chrome.storage.sync.get(s);for(const e of s)(!(e in o)||o[e]===void 0)&&await chrome.storage.sync.set({[e]:!1});chrome.storage.sync.set({presentModal:!1}).catch(()=>{console.log("[STORAGE] Could not set storage item")})}});function h(){return chrome.runtime.id?chrome.storage.sync.get(["toggleState","toggleNavState","toggleHomeFeedState","toggleHomeFeedStateLives","toggleHomeFeedStatePremieres","toggleSubscriptionFeedState","toggleSubscriptionFeedStateLives","toggleSubscriptionFeedStatePremieres","toggleTrendingFeedState","toggleSearchState","toggleRecommendedState","toggleTabState","toggleHomeTabState","toggleTurboState","toggleRegularState","toggleNotificationState","blockList"]):location.reload()}function c(t,s){chrome.scripting.insertCSS({files:s,target:{tabId:t}}).catch(o=>{console.log("Error inserting styles",o)})}function n(t,s){chrome.scripting.removeCSS({files:s,target:{tabId:t}}).catch(o=>{console.log("Error removing styles",o)})}function P(t){chrome.scripting.removeCSS({files:["channel_shorts_tab.css","channel_shorts_unhide.css","assets/home_lives.css","assets/home_premieres.css","assets/home_shorts.css","assets/home_tab_shorts.css","assets/navigation_button.css","assets/notification_shorts.css","assets/recommended_shorts.css","assets/search_shorts.css","assets/subscriptions_feed_fix.css","assets/subscriptions_lives.css","assets/subscriptions_premieres.css","assets/subscriptions_shorts.css","assets/subscriptions_shorts_list.css","assets/trending_shorts.css"],target:{tabId:t}}).catch(s=>{console.log("Error removing styles",s)}),chrome.scripting.executeScript({function:()=>{let s=0;function o(){if(s>=25){s=0;return}const e=document.querySelectorAll(".tab-content"),r=Array.from(e).filter(i=>i.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");r.length>0?(r.forEach(i=>{i.parentNode.style.display="inline-flex"}),s=0):(s++,setTimeout(o,100))}o()},target:{tabId:t}}).catch(s=>{console.log("Error executing script",s)})}chrome.runtime.onMessage.addListener(async function(t,s,o){if(t.checkStates){const e=await h();chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(r){r.forEach(i=>{t.checkStates==="toggleState"&&R(i,i.id,e.toggleState),t.checkStates==="toggleNavState"&&S(i,i.id,e.toggleNavState),t.checkStates==="toggleHomeFeedState"&&m(i,i.id,e.toggleHomeFeedState),t.checkStates==="toggleHomeFeedStateLives"&&d(i,i.id,e.toggleHomeFeedStateLives),t.checkStates==="toggleHomeFeedStatePremieres"&&p(i,i.id,e.toggleHomeFeedStatePremieres),t.checkStates==="toggleSubscriptionFeedState"&&y(i,i.id,e.toggleSubscriptionFeedState),t.checkStates==="toggleSubscriptionFeedStateLives"&&w(i,i.id,e.toggleSubscriptionFeedStateLives),t.checkStates==="toggleSubscriptionFeedStatePremieres"&&F(i,i.id,e.toggleSubscriptionFeedStatePremieres),t.checkStates==="toggleTrendingFeedState"&&_(i,i.id,e.toggleTrendingFeedState),t.checkStates==="toggleSearchState"&&v(i,i.id,e.toggleSearchState),t.checkStates==="toggleRecommendedState"&&T(i,i.id,e.toggleRecommendedState),t.checkStates==="toggleNotificationState"&&k(i,i.id,e.toggleNotificationState),t.checkStates==="toggleTabState"&&L(i,i.id,e.toggleTabState),t.checkStates==="toggleHomeTabState"&&H(i,i.id,e.toggleHomeTabState),t.checkStates==="toggleRegularState"&&x(i,i.id,e.toggleRegularState)})})}if(t.blockList){const e=await h();chrome.tabs.query({url:["https://www.youtube.com/*","https://m.youtube.com/*"]},function(r){r.forEach(i=>{t.blockList==="add"&&u(i.id,"add",e.blockList),t.blockList.action==="remove"&&u(i.id,"remove",t.blockList.channelName),t.blockList==="clear"&&u(i.id,"clear",e.blockList)})})}});chrome.tabs.onUpdated.addListener(async function(t,s,o){if(chrome.runtime.id&&(o.url.startsWith("https://www.youtube.com/")||o.url.startsWith("https://m.youtube.com/"))){const e=await h();if(!e.toggleState||s.status!=="loading")return;S(o,t,e.toggleNavState),m(o,t,e.toggleHomeFeedState),d(o,t,e.toggleHomeFeedStateLives),p(o,t,e.toggleHomeFeedStatePremieres),y(o,t,e.toggleSubscriptionFeedState),w(o,t,e.toggleSubscriptionFeedStateLives),F(o,t,e.toggleSubscriptionFeedStatePremieres),_(o,t,e.toggleTrendingFeedState),v(o,t,e.toggleSearchState),T(o,t,e.toggleRecommendedState),k(o,t,e.toggleNotificationState),L(o,t,e.toggleTabState),H(o,t,e.toggleHomeTabState),x(o,t,e.toggleRegularState),e.blockList&&e.blockList.length>0&&u(t,"add",e.blockList)}});async function R(t,s,o){if(o){const e=await h();e.toggleNavState&&S(t,s,e.toggleNavState),e.toggleHomeFeedState&&m(t,s,e.toggleHomeFeedState),e.toggleHomeFeedStateLives&&d(t,s,e.toggleHomeFeedStateLives),e.toggleHomeFeedStatePremieres&&p(t,s,e.toggleHomeFeedStatePremieres),e.toggleSubscriptionFeedState&&y(t,s,e.toggleSubscriptionFeedState),e.toggleSubscriptionFeedStateLives&&w(t,s,e.toggleSubscriptionFeedStateLives),e.toggleSubscriptionFeedStatePremieres&&F(t,s,e.toggleSubscriptionFeedStatePremieres),e.toggleTrendingFeedState&&_(t,s,e.toggleTrendingFeedState),e.toggleSearchState&&v(t,s,e.toggleSearchState),e.toggleRecommendedState&&T(t,s,e.toggleRecommendedState),e.toggleNotificationState&&k(t,s,e.toggleNotificationState),e.toggleTabState&&L(t,s,e.toggleTabState),e.toggleHomeTabState&&H(t,s,e.toggleHomeTabState),e.toggleRegularState&&x(t,s,e.toggleRegularState),e.blockList&&e.blockList.length>0&&u(s,"add",e.blockList)}o||P(s)}const N=["https://www.youtube.com/","https://www.youtube.com/?app=desktop","https://m.youtube.com/"],f=["https://www.youtube.com/feed/subscriptions","https://www.youtube.com/feed/subscriptions?app=desktop","https://m.youtube.com/feed/subscriptions","https://www.youtube.com/feed/subscriptions?flow=1"],C=["https://www.youtube.com/feed/trending","https://www.youtube.com/gaming","https://m.youtube.com/feed/explore","https://m.youtube.com/feed/trending"],E=["https://www.youtube.com/channel/","https://www.youtube.com/@","https://www.youtube.com/user/","https://www.youtube.com/c/","https://m.youtube.com/channel/","https://m.youtube.com/@","https://m.youtube.com/user/","https://m.youtube.com/c/"];function u(t,s,o){s==="add"&&o.forEach(e=>{chrome.scripting.insertCSS({css:`
            ytd-rich-item-renderer:has(a[href*="/@${e}"]) {
                display: none !important;
            }
            ytd-shelf-renderer:has(a[href*="/@${e}"]) {
                display: none !important;
            }
            ytd-video-renderer:has(a[href*="/@${e}"]) {
                display: none !important;
            }
            `,target:{tabId:t}}).catch(r=>{console.log("Error inserting styles",r)})}),s==="remove"&&chrome.scripting.insertCSS({css:`
            ytd-rich-item-renderer:has(a[href*="/@${o}"]) {
                display: inline-flex !important;
            }
            ytd-shelf-renderer:has(a[href*="/@${o}"]) {
                display: inline-flex !important;
            }
            ytd-video-renderer:has(a[href*="/@${o}"]) {
                display: inline-flex !important;
            }
            `,target:{tabId:t}}).catch(e=>{console.log("Error inserting styles",e)}),s==="clear"&&o.forEach(e=>{chrome.scripting.insertCSS({css:`
                ytd-rich-item-renderer:has(a[href*="/@${e}"]) {
                    display: inline-flex !important;
                }
                ytd-shelf-renderer:has(a[href*="/@${e}"]) {
                    display: inline-flex !important;
                }
                ytd-video-renderer:has(a[href*="/@${e}"]) {
                    display: inline-flex !important;
                }
            `,target:{tabId:t}}).catch(r=>{console.log("Error inserting styles",r)})})}function S(t,s,o){if(t.url.startsWith("https://www.youtube.com/")||t.url.startsWith("https://m.youtube.com/")){const e=["assets/navigation_button.css"];o&&c(s,e),o||n(s,e)}}function m(t,s,o){if(N.includes(t.url)){const e=["assets/home_shorts.css"];o&&c(s,e),o||n(s,e)}}function d(t,s,o){if(t.url==="https://www.youtube.com/"){const e=["assets/home_lives.css"];o&&c(s,e),o||n(s,e)}}function p(t,s,o){if(t.url==="https://www.youtube.com/"){const e=["assets/home_premieres.css"];o&&c(s,e),o||n(s,e)}}function y(t,s,o){if(f.includes(t.url)){const e=["assets/subscriptions_shorts.css","assets/subscriptions_shorts_list.css","assets/subscriptions_feed_fix.css"];o&&c(s,e),o||n(s,e)}if(t.url==="https://www.youtube.com/feed/subscriptions?flow=2"){const e=["assets/subscriptions_shorts_list.css"];o&&c(s,e),o||n(s,e)}}function w(t,s,o){if(f.includes(t.url)){const e=["assets/subscriptions_lives.css","assets/subscriptions_feed_fix.css"];o&&c(s,e),o||n(s,e)}}function F(t,s,o){if(f.includes(t.url)){const e=["assets/subscriptions_premieres.css","assets/subscriptions_feed_fix.css"];o&&c(s,e),o||n(s,e)}}function _(t,s,o){if(C.some(e=>t.url.startsWith(e))){const e=["assets/trending_shorts.css"];o&&c(s,e),o||n(s,e)}}function v(t,s,o){if(t.url.startsWith("https://www.youtube.com/results")||t.url.startsWith("https://m.youtube.com/results")){const e=["assets/search_shorts.css"];o&&c(s,e),o||n(s,e)}}function T(t,s,o){if(t.url.startsWith("https://www.youtube.com/watch")){const e=["assets/recommended_shorts.css"];o&&c(s,e),o||n(s,e)}}function k(t,s,o){if(t.url.startsWith("https://www.youtube.com/")){const e=["assets/notification_shorts.css"];o&&c(s,e),o||n(s,e)}}function H(t,s,o){if(E.some(e=>t.url.startsWith(e))){const e=["assets/home_tab_shorts.css"];o&&c(s,e),o||n(s,e)}}function L(t,s,o){if(E.some(e=>t.url.startsWith(e))){const e=["assets/channel_shorts_tab.css"];o?(chrome.scripting.executeScript({function:()=>{let r=0;function i(){if(r>=25){r=0;return}const g=document.querySelectorAll(".tab-content"),a=Array.from(g).filter(l=>l.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");a.length>0?(a.forEach(l=>{l.parentNode.style.display="none"}),r=0):(r++,setTimeout(i,100))}i()},target:{tabId:s}}).catch(r=>{console.log("Error executing script",r)}),c(s,e)):(setTimeout(()=>{c(s,["assets/channel_shorts_unhide.css"])},500),chrome.scripting.executeScript({function:()=>{let r=0;function i(){if(r>=25){r=0;return}const g=document.querySelectorAll(".tab-content"),a=Array.from(g).filter(l=>l.textContent.replace(/\s/g,"").replace(/\n/g,"")==="Shorts");a.length>0?(a.forEach(l=>{l.parentNode.style.display="inline-flex"}),r=0):(r++,setTimeout(i,100))}i()},target:{tabId:s}}).catch(r=>{console.log("Error executing script",r)}),n(s,e))}}function x(t,s,o){if(t.url.startsWith("https://www.youtube.com/shorts/")||t.url.startsWith("https://m.youtube.com/shorts/")){let r=function(g){const a=/\/shorts\/([^/]+)/,l=g.match(a);return l?l[1]:null};var e=r;const i=r(t.url);if(i&&o){const g=`https://youtube.com/watch?v=${i}`;chrome.tabs.update(s,{url:g})}}}
